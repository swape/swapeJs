var sjs=function(){"use strict";function s(e,t){var n=e.split(" ").length,r=e.charAt(0);return"#"===r&&1===n?document.getElementById(e.replace("#","")):t?document.querySelectorAll(e):document.querySelector(e)}function a(e,t,n){if(!t)return!1;var r=s(e,!0);if(r&&"undefined"!=typeof r&&r.length>0){for(var i=0;i<r.length;i++)r[i]&&r[i][t]&&(n?r[i][t]=r[i][t].replace(n,"").trim():(r[i][t]=null,r[i].removeAttribute(t)));return r}}function u(e,t,n){if(!t||!n)return!1;var r="object"==typeof e?e:s(e,!0);if(r&&"undefined"!=typeof r&&r.length>0){for(var i=0;i<r.length;i++)r[i]&&(r[i][t]?"class"===t?r[i].className=n:r[i][t]=r[i][t]+" "+n:"class"===t?r.className=n:r.attr=n);return r}}function c(e,t,n){var r=s(e,!0);if(!r||"undefined"==typeof r)return!1;if(t){if(r&&r.length>0)for(var i=0;i<r.length;i++)r[i]&&("class"===t?r[i].className=n:r[i][t]=n);else"class"===t?r.className=n:r.attr=n;return r}}function v(e,t){var n=s(e);return n?t&&"undefined"!=typeof n[t]?n[t]:n:void 0}function d(e,t){var n=s(e,!0);if(n){if(t){var r=[];if(n.length>0){for(var i=0;i<n.length;i++)n[i]&&t&&n[i]&&"undefined"!=typeof n[i][t]&&""!==n[i][t].trim()&&r.push(n[i][t]);return r.length>0?r:!1}return!1}return n}}function p(){var n=0;if(e&&e.length>0){for(n=0;e.length>n;n++)e[n].route===t&&(g(e[n]),i=!0),e[n]["default"]&&(f=e[n]);i===!1&&f&&g(f)}}function g(e){e.template?(L.innerHTML=e.template,m(e)):e.templateUrl&&(l[e.templateUrl]?(L.innerHTML=l[e.templateUrl],m(e)):T("get",e.templateUrl).then(function(t){L.innerHTML=t,m(e),l[e.templateUrl]=t},function(e){console.log(e)})),H()}function m(e){y(),e.controller&&e.controller()}function h(e,t){return new Promise(function(n,r){var i=[];l[t]?(e.innerHTML=l[t],i=e.querySelectorAll("view [sjs-route]"),w(i)):T("get",t).then(function(r){e.innerHTML=r,l[t]=r,i=e.querySelectorAll("view [sjs-route]"),w(i),n("ok")},function(){r("could not find "+t)})})}function y(){for(var e=d("view [sjs-include]"),t="",n=0;e.length>n;n++)t=e[n].getAttribute("sjs-include"),t&&t.length>0&&h(e[n],t)}function j(e){n=e||location.hash,""!==n&&(n=n.replace(r,"").replace("#",""),n=n.split("/"),n.length>0&&(t=n[0]))}function N(e){j(e),location.hash=e}function S(e){e.target.attributes["sjs-route"]&&e.target.attributes["sjs-route"].value&&(e.preventDefault(),t=e.target.attributes["sjs-route"].value,N(t),p())}function w(e){for(o=0;e.length>o;o++)e[o].addEventListener("click",S)}function H(){a("[sjs-route]","className","active");var e=v('[sjs-route="'+n[0]+'"]');e.className=e.className?e.className+" active":"active"}function T(e,t,n,r){return new Promise(function(i,f){var l=new XMLHttpRequest;if(e=e.toUpperCase(),"POST"!==e){var s,o=[];if("undefined"!=typeof n&&null!==n){t=t.match(/\?/gim)?t+"&":t+"?";for(s in n)o.push(encodeURIComponent(s)+"="+encodeURIComponent(n[s]));t+=o.join("&")}}if(l.open(e,t),"undefined"!=typeof r){var a="";for(a in r)l.setRequestHeader(a,r[a])}l.onload=function(){200===l.status?i(l.response):f(Error(l.statusText))},l.onerror=function(){f(Error("Network Error"))},"POST"===e?"undefined"!=typeof n&&null!==n&&l.send(JSON.stringify(n)):l.send()})}function U(e){N(e),p()}var e=[],t="",n="",r="#/",i=!1,f=!1,l={},o=0;j();var A=d("[sjs-route]"),L=v("view");return w(A),{init:function(){p()},route:function(t){e=t},gotoState:U,getState:function(){return t},getHash:function(){return n},get:v,getAll:d,set:c,add:u,remove:a,xhr:T}}();