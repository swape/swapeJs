var sjs=function(){"use strict";function i(e,t){var r=e.split(" ").length,n=e.charAt(0);return"#"===n&&1===r?document.getElementById(e.replace("#","")):t?document.querySelectorAll(e):document.querySelector(e)}function a(e,t,r){if(!t)return!1;var n=i(e,!0);if(n&&"undefined"!=typeof n&&n.length>0){for(var s=0;s<n.length;s++)n[s]&&n[s][t]&&(r?n[s][t]=n[s][t].replace(r,"").trim():(n[s][t]=null,n[s].removeAttribute(t)));return n}}function f(e,t,r){if(!t||!r)return!1;var n="object"==typeof e?e:i(e,!0);if(n&&"undefined"!=typeof n&&n.length>0){for(var s=0;s<n.length;s++)n[s]&&(n[s][t]?"class"===t?n[s].className=r:n[s][t]=n[s][t]+" "+r:"class"===t?n.className=r:n.attr=r);return n}}function o(e,t,r){var n=i(e,!0);if(!n||"undefined"==typeof n)return!1;if(t){if(n&&n.length>0)for(var s=0;s<n.length;s++)n[s]&&("class"===t?n[s].className=r:n[s][t]=r);else"class"===t?n.className=r:n.attr=r;return n}}function l(e,t){var r=i(e);return r?t&&"undefined"!=typeof r[t]?r[t]:r:void 0}function u(e,t){var r=i(e,!0);if(r){if(t){var n=[];if(r.length>0){for(var s=0;s<r.length;s++)r[s]&&t&&r[s]&&"undefined"!=typeof r[s][t]&&""!==r[s][t].trim()&&n.push(r[s][t]);return n.length>0?n:!1}return!1}return r}}function c(){var n=0;if(e.routes&&e.routes.length>0){for(n=0;e.routes.length>n;n++)e.routes[n].route===e.state&&(h(e.routes[n]),t=!0),e.routes[n]["default"]&&(r=e.routes[n]);t===!1&&r&&h(r)}}function h(e){e.template?(T.innerHTML=e.template,v(e)):e.templateUrl&&(n[e.templateUrl]?(T.innerHTML=n[e.templateUrl],v(e)):S("get",e.templateUrl).then(function(t){T.innerHTML=t,v(e),n[e.templateUrl]=t},function(e){console.log(e)})),N()}function v(e){p(),e.controller&&e.controller()}function d(e,t){return new Promise(function(r,s){var i=[];n[t]?(e.innerHTML=n[t],i=e.querySelectorAll("view [sjs-route]"),j(i)):S("get",t).then(function(s){e.innerHTML=s,n[t]=s,i=e.querySelectorAll("view [sjs-route]"),j(i),r("ok")},function(){s("could not find "+t)})})}function p(){for(var e=u("view [sjs-include]"),t="",r=0;e.length>r;r++)t=e[r].getAttribute("sjs-include"),t&&t.length>0&&d(e[r],t)}function g(t){e.hash=t||location.hash,""!==e.hash&&(e.hash=e.hash.replace(e.startHashSign,"").replace("#",""),e.hash=e.hash.split("/"),e.hash.length>0&&(e.state=e.hash[0]))}function m(e){g(e),location.hash=e}function y(t){t.target.attributes["sjs-route"]&&t.target.attributes["sjs-route"].value&&(t.preventDefault(),e.state=t.target.attributes["sjs-route"].value,m(e.state),c())}function j(e){for(s=0;e.length>s;s++)e[s].addEventListener("click",y)}function N(){a("[sjs-route]","className","active");var t=l('[sjs-route="'+e.hash[0]+'"]');t.className=t.className?t.className+" active":"active"}function S(e,t,r,n){return new Promise(function(s,i){var a=new XMLHttpRequest;if(e=e.toUpperCase(),"POST"!==e){var o,f=[];if("undefined"!=typeof r&&null!==r){t=t.match(/\?/gim)?t+"&":t+"?";for(o in r)f.push(encodeURIComponent(o)+"="+encodeURIComponent(r[o]));t+=f.join("&")}}if(a.open(e,t),"undefined"!=typeof n){var l="";for(l in n)a.setRequestHeader(l,n[l])}a.onload=function(){200===a.status?s(a.response):i(Error(a.statusText))},a.onerror=function(){i(Error("Network Error"))},"POST"===e?"undefined"!=typeof r&&null!==r&&a.send(JSON.stringify(r)):a.send()})}function H(e){m(e),c()}var e={routes:[],state:"",hash:"",startHashSign:"#/"},t=!1,r=!1,n={},s=0;g();var w=u("[sjs-route]"),T=l("view");return j(w),{init:function(){c()},objRoutes:e,gotoState:H,get:l,getAll:u,set:o,add:f,remove:a,xhr:S}}();